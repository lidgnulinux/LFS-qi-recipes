# Build recipe for giflib.
#

# Exit immediately on any error
set -e

program=giflib
version=5.2.2
release=0
description="A library for reading and writing GIF images"
homepage="https://sourceforge.net/projects/giflib/"
license="MIT"

tarname=giflib-$version.tar.gz
fetch="https://downloads.sourceforge.net/sourceforge/giflib/$tarname"

build() 
{
	unpack "${tardir}/$tarname"
	
	cd "$srcdir"
	
	# Set sane permissions
	chmod -R u+w,go-w,a+rX-s .

	patch -p1 < "${worktree}/CVE-2021-40633.patch"
	patch -p1 < "${worktree}/CVE-2025-31344.patch"
	patch -p1 < "${worktree}/correct-document-page-install.patch"
	patch -p1 < "${worktree}/dont-build-html-pages-images.patch"

	make CFLAGS="$CFLAGS -fPIC"
	make DESTDIR="$destdir" PREFIX=/usr install 
}
